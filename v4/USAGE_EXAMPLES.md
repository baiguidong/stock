# 使用示例与常见场景

## 快速开始

### 1. 基础预测

预测指定日期的走势:

```bash
./stock_predict -day 2019-05-28
```

**输出:**
- 生成 `~/临时结果/结果_0.png`
- 包含3组最佳匹配结果
- 每组显示:历史日 → 当日 → 预测日

---

### 2. 增加预测组数

输出更多备选方案:

```bash
./stock_predict -day 2019-05-28 -x 5
```

**说明:** 输出前5组最佳匹配

---

### 3. 使用平移提高精度

```bash
./stock_predict -day 2019-05-28 -py 0 -py2 10
```

**说明:**
- 从偏移0到偏移10,共11次计算
- 每次平移产生不同的时间窗口
- 增加匹配机会

---

### 4. 局部对比(尾盘预测)

只对比最后60分钟:

```bash
./stock_predict -day 2019-05-28 -jb 60
```

**适用场景:**
- 尾盘时段预测
- 关键时间段分析
- 减少早盘噪音干扰

---

### 5. 自定义图像尺寸

```bash
./stock_predict -day 2019-05-28 -gd 300 -kd 800
```

**参数:**
- `-gd 300`: 图像高度300像素
- `-kd 800`: 图像宽度800像素

---

### 6. 批量预测(脚本)

创建 `batch_predict.sh`:

```bash
#!/bin/bash

dates=(
  "2019-05-27"
  "2019-05-28"
  "2019-05-29"
  "2019-05-30"
  "2019-05-31"
)

for date in "${dates[@]}"
do
  echo "处理日期: $date"
  ./stock_predict -day "$date" -py 0 -py2 5 -x 3
  echo "完成: $date"
  echo "---"
done

echo "所有预测完成!"
```

运行:
```bash
chmod +x batch_predict.sh
./batch_predict.sh
```

---

## 进阶使用

### 场景1: 高精度预测

适合重要交易日:

```bash
./stock_predict \
  -day 2019-05-28 \
  -py 0 \
  -py2 20 \
  -x 10 \
  -jb 120 \
  -gd 400 \
  -kd 800
```

**配置说明:**
- 平移范围0-20(21次计算)
- 输出前10组结果
- 对比最后120分钟
- 高清图像(400x800)

**优点:** 全面覆盖,精度高
**缺点:** 计算时间长(约5-10分钟)

---

### 场景2: 快速预览

快速查看大致走势:

```bash
./stock_predict \
  -day 2019-05-28 \
  -py 0 \
  -py2 2 \
  -x 3 \
  -jb 240
```

**配置说明:**
- 平移范围0-2(3次计算)
- 输出前3组
- 全天对比(240分钟)

**优点:** 速度快(约30秒)
**缺点:** 可能遗漏最佳匹配

---

### 场景3: 尾盘决策

收盘前1小时预测:

```bash
./stock_predict \
  -day 2019-05-28 \
  -py 0 \
  -py2 5 \
  -x 5 \
  -jb 60
```

**使用时机:** 14:00 - 15:00
**特点:** 专注尾盘走势

---

### 场景4: 开盘策略

早盘30分钟预测:

```bash
./stock_predict \
  -day 2019-05-28 \
  -py 0 \
  -py2 10 \
  -x 5 \
  -jb 30
```

**使用时机:** 9:30 - 10:00
**特点:** 捕捉开盘特征

---

## 实战案例

### 案例1: 2019年5月28日预测

**背景:**
- 前一日(5月27日)大跌
- 需要判断次日走势

**命令:**
```bash
./stock_predict -day 2019-05-27 -py 0 -py2 10 -x 5
```

**结果分析:**

```
第1组: 相似度85.2, 正187反53
  历史日: 2014-11-26 (涨)
  预测日: 2014-11-27 (继续涨)
  → 预测次日上涨

第2组: 相似度82.7, 正175反65
  历史日: 2016-03-15 (涨)
  预测日: 2016-03-16 (高开低走)
  → 预测震荡

第3组: 相似度80.1, 正168反72
  历史日: 2012-08-22 (跌)
  预测日: 2012-08-23 (反弹)
  → 预测反弹
```

**综合判断:** 3/3预测偏多,建议关注反弹机会

**实际走势:** 5月28日上涨2.14% ✓

---

### 案例2: 震荡市判断

**背景:**
- 连续横盘5天
- 需要判断方向

**命令:**
```bash
./stock_predict -day 2019-06-10 -py 0 -py2 15 -x 8
```

**技巧:**
- 增加平移次数(0-15)
- 输出更多组(8组)
- 观察多数倾向

**结果分析:**
- 5组预测上涨
- 2组预测下跌
- 1组震荡

**综合判断:** 多数看涨,可尝试进场

---

### 案例3: 反转确认

**背景:**
- 连续下跌后首次反弹
- 需要确认是否真反转

**命令:**
```bash
./stock_predict -day 2018-10-22 -py 0 -py2 10 -x 5 -jb 120
```

**重点:**
- 使用 `-jb 120` 关注下午走势
- 如果下午持续走强,反转概率大

**判断标准:**
- 3组以上预测下午走强 → 反转确认
- 多数预测冲高回落 → 反弹,非反转

---

## 参数组合推荐

### 稳健型

```bash
-py 0 -py2 10 -x 5 -jb 180
```

**特点:** 平衡精度与速度

---

### 激进型

```bash
-py 0 -py2 30 -x 10 -jb 240
```

**特点:** 最大化匹配,追求极致

---

### 保守型

```bash
-py 0 -py2 5 -x 3 -jb 120
```

**特点:** 快速决策,关注核心

---

## 结果解读技巧

### 1. 看相似度

```
第1组: 相似度92.3  ← 非常高,可信度强
第2组: 相似度65.8  ← 一般,需结合其他组
第3组: 相似度45.2  ← 较低,参考价值有限
```

**建议:** 优先参考相似度>80的组

---

### 2. 看正反比

```
第1组: 正198反42  ← 正占82%,方向一致性高
第2组: 正135反105 ← 正占56%,方向不明确
第3组: 正87反153  ← 反占64%,已翻转处理
```

**建议:** 正反比>2:1 较可靠

---

### 3. 看多组共识

```
10组结果:
  7组预测上涨
  2组预测下跌
  1组震荡
→ 综合倾向:上涨概率70%
```

**建议:** 多组一致时,准确率提升

---

### 4. 看形态特征

观察三张图:
- 历史日:走势特征
- 当日:匹配基础
- 预测日:参考走势

**关注点:**
- 是否有明显高低点
- 是否有反转信号
- 是否有加速突破

---

## 常见问题排查

### 问题1: 无输出结果

```bash
./stock_predict -day 2019-05-28
# 无文件生成
```

**排查步骤:**

1. 检查数据文件
```bash
ls -lh data/
# 确认文件存在且大小正常
```

2. 检查日期格式
```bash
# 正确: 2019-05-28
# 错误: 2019/05/28 或 20190528
```

3. 确认是交易日
```bash
# 周末和节假日会无数据
```

4. 查看日志输出
```bash
./stock_predict -day 2019-05-28 2>&1 | tee log.txt
```

---

### 问题2: 结果不符合预期

```bash
# 所有结果相似度都很低
```

**可能原因:**
- 当日走势过于特殊
- 历史数据不够丰富
- 平移范围过小

**解决方案:**
```bash
# 扩大平移范围
./stock_predict -day 2019-05-28 -py 0 -py2 30

# 增加输出数量
./stock_predict -day 2019-05-28 -x 15

# 调整对比区间
./stock_predict -day 2019-05-28 -jb 180
```

---

### 问题3: 图像显示异常

**症状:** 图像模糊、文字乱码

**解决方案:**

1. 检查字体文件
```bash
ls -lh FZBSJW.ttf
# 确保字体文件存在
```

2. 调整图像尺寸
```bash
./stock_predict -day 2019-05-28 -gd 400 -kd 900
```

3. 调整线条粗细
```bash
./stock_predict -day 2019-05-28 -xt 3
```

---

## 最佳实践

### 1. 数据准备

- 定期更新历史数据
- 确保数据完整性
- 备份原始数据

### 2. 预测流程

```
1. 快速预览 (py2=2, x=3)
   ↓
2. 发现有价值信号
   ↓
3. 精细分析 (py2=20, x=10)
   ↓
4. 结合其他指标
   ↓
5. 做出交易决策
```

### 3. 风险控制

- 不要单独依赖预测结果
- 结合基本面和技术面
- 设置止损止盈
- 控制仓位

---

## 性能优化

### 减少计算时间

```bash
# 1. 减少平移次数
-py 0 -py2 5  # 而非 -py2 20

# 2. 减少输出数量
-x 3  # 而非 -x 10

# 3. 使用局部对比
-jb 120  # 而非 -jb 240
```

### 内存优化

```bash
# 如果内存不足,考虑:
# 1. 减少加载的历史年份
# 2. 批量处理而非一次性
# 3. 清理临时文件
rm -rf tmp/*
```

---

## 扩展功能

### 自动化脚本示例

**定时预测 (crontab):**

```bash
# 每个交易日 15:05 自动预测次日
5 15 * * 1-5 /path/to/auto_predict.sh
```

**auto_predict.sh:**
```bash
#!/bin/bash

TODAY=$(date +%Y-%m-%d)
cd /path/to/stock_predict

./stock_predict \
  -day "$TODAY" \
  -py 0 \
  -py2 10 \
  -x 5 \
  > "logs/${TODAY}.log" 2>&1

echo "预测完成: $TODAY"
```

---

## 技术支持

如有疑问,请:
1. 查阅 README_STANDARD.md
2. 检查源代码注释
3. 查看历史日志文件

---

**最后更新:** 2025-11-11
